# key-value-storage
a simple key value storage written in golang

---

# Инструкция по запуску

1) Клонируем репозиторий:

`
git clone git@github.com:cutlery47/key-value-storage.git
`

2) Прямо в директории проекта компилируем исходный код в исполняемый файл:

`
make all
`

3) В исходном терминале запускаем хранилище:

`
storage/build/app
`

4) Открываем второй терминал и запускаем клиент:

`
client/build/app -op=<операция-над-хранилищем> -key=<ключ> -val=<значение> 
-ttl=<время-существования-записи>
`

---

# Инструкция по работе с клиентом

Для работы с клиентом рекоммендуется ознакомиться с параметрами, принимаемыми 
клиентом:

`
client/build/app -h
`

Вывод:

```
Usage of client/build/app:
  -key string
        key to be inserted
  -op string
        operation to be executed
  -ttl duration
        key's time to live in the object storage
  -val string
        value to be paired with the key
```

1) key (string) - ключ, по которому мы хотим добавить запись в хранилище.
2) val (string) - значение, которое мы хотим записать в хранилище.
3) ttl (time.Duration) - продолжительность жизни записи в хранилище

   Формат ввода - "%t%u", где 
   
   %u - единица времени хранения записи 
   (Например: h, m, s - час, минута, секунда соответственно)
                             
   %t - число единиц времени хранения записи (Например: 10, 200, 1000)
   
   Итого получаем что-то типа: 10h ~10 часов, 5s ~ 5 секунд, 60m ~ 60 минут
   
4) op (string) - операция, производимая над записью

### Поддерживаемые операции:
   
   
- add - Добавление записи в хранилище
    
- set - Изменение записи в хранилище
   
- get - Получение записи из хранилища
    
- del - Удаление записи из хранидища
   
# Примеры работы программы



Кейс 1: Хотим добавить значение "somevalue" по ключу "somekey" с временем жизни = 10 минут

```
client/build/app -op=add -key=somekey -val=somevalue -ttl=10m
```

Вывод:

`Success!`

---

Кейс 2: Хотим добавить изменить значение предыдущего ключа на "foobar"

```
client/build/app -op=set -key=somekey -val=foobar 
```

Выыод:

`Success!`

---

Кейс 3: Хотим убедиться, что значение этой записи изменилось

```
client/build/app -op=get -key=somekey

```

Вывод:

`{"key":"somekey","value":"foobar"}`

---

Кейс 4: Хотим вовсе удалить запись из хранилища
   
```
client/build/app -op=del -key=somekey

```        

Выыод:

`Success!`

# Дополнительные сведения

- Хранилище слушает входящие http-соединения на порту 8080, соответственно перед запуском убедитесь, что данный порт не занят.
- По умолчанию, если не указан ttl при создании записи, она будет существовать в хранилище 24 часа.
- По умолчанию, если не указан val при создании записи, она автоматически инициализируется с пустым значением ("").
- Очистка хранилища от записей, ttl которых истек, производится раз в 10 секунд.
- Данные хранятся в файле storage.data в корневой директории проекта